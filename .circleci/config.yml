version: 2.1

orbs:
  maven: circleci/maven@1.1.1
  slack: circleci/slack@4.3.0

jobs:
  test: # name of your job
    working_directory: ~/project/
    docker: # executor type
      - image: buildpack-deps:trusty # primary container will run Ubuntu Trusty
    steps:
      - run:
          name: cloning github
          command: 'git clone https://github.com/keepid/keepid_server.git; cd keepid_server'
      - run:
          name: going in
          command: 'cd keepid_server'
      - run:
          name: listing all
          command: 'ls -a'
      - run:
          name: Generate google credentials json
          command: 'sh ./credential-generate.sh'
      - run:
          command: 'mvn test -B'
      - slack/notify:
          event: fail
          template: basic_fail_1
      - slack/notify:
          event: pass
          template: basic_success_1

workflows:
  test_keepid_staging:
    jobs:
      - test:
          context: Keep.id Slack